<?php

namespace App\Rules;

use Closure;
use Illuminate\Contracts\Validation\ValidationRule;

class PhoneNumberFormat implements ValidationRule
{
    protected $countryCode;

    public function __construct($countryCode)
    {
        $this->countryCode = $countryCode;
    }

    /**
     * Run the validation rule.
     */
    public function validate(string $attribute, mixed $value, Closure $fail): void
    {
        $phoneFormats = [
            'AE' => '/^\+971[0-9]{9}$/',
            'SA' => '/^\+966[0-9]{9}$/',
            'EG' => '/^\+20[0-9]{10}$/',
            'US' => '/^\+1[0-9]{10}$/',
            'GB' => '/^\+44[0-9]{10}$/',
            'FR' => '/^\+33[0-9]{9}$/',
            'DE' => '/^\+49[0-9]{10,11}$/',
            'IT' => '/^\+39[0-9]{9,10}$/',
            'ES' => '/^\+34[0-9]{9}$/',
            'IN' => '/^\+91[0-9]{10}$/',
            'PK' => '/^\+92[0-9]{10}$/',
            'JO' => '/^\+962[0-9]{9}$/',
            'LB' => '/^\+961[0-9]{8}$/',
            'KW' => '/^\+965[0-9]{8}$/',
            'QA' => '/^\+974[0-9]{8}$/',
            'BH' => '/^\+973[0-9]{8}$/',
            'OM' => '/^\+968[0-9]{8}$/',
            'YE' => '/^\+967[0-9]{9}$/',
            'IQ' => '/^\+964[0-9]{10}$/',
            'SY' => '/^\+963[0-9]{9}$/',
            'CN' => '/^\+86[0-9]{11}$/',
            'JP' => '/^\+81[0-9]{10}$/',
            'KR' => '/^\+82[0-9]{9,10}$/',
            'AU' => '/^\+61[0-9]{9}$/',
            'CA' => '/^\+1[0-9]{10}$/',
            'BR' => '/^\+55[0-9]{10,11}$/',
            'MX' => '/^\+52[0-9]{10}$/',
            'AR' => '/^\+54[0-9]{10}$/',
            'ZA' => '/^\+27[0-9]{9}$/',
            'NG' => '/^\+234[0-9]{10}$/',
            'TR' => '/^\+90[0-9]{10}$/',
            'RU' => '/^\+7[0-9]{10}$/',
        ];

        $format = $phoneFormats[$this->countryCode] ?? $phoneFormats['AE'];

        if (!preg_match($format, $value)) {
            $placeholders = [
                'AE' => '+9715XXXXXXXX',
                'SA' => '+9665XXXXXXXX',
                'EG' => '+201234567890',
                'US' => '+11234567890',
                'GB' => '+447123456789',
                'FR' => '+33123456789',
                'DE' => '+491234567890',
                'IT' => '+39123456789',
                'ES' => '+34123456789',
                'IN' => '+911234567890',
                'PK' => '+923001234567',
                'JO' => '+962791234567',
                'LB' => '+9613123456',
                'KW' => '+96512345678',
                'QA' => '+97433123456',
                'BH' => '+97336123456',
                'OM' => '+96892123456',
                'YE' => '+967712345678',
                'IQ' => '+9647901234567',
                'SY' => '+963912345678',
                'CN' => '+8613123456789',
                'JP' => '+9012345678',
                'KR' => '+1023456789',
                'AU' => '+6123456789',
                'CA' => '+11234567890',
                'BR' => '+5511987654321',
                'MX' => '+521234567890',
                'AR' => '+541123456789',
                'ZA' => '+27123456789',
                'NG' => '+2348123456789',
                'TR' => '+905321234567',
                'RU' => '+79123456789',
            ];

            $placeholder = $placeholders[$this->countryCode] ?? $placeholders['AE'];
            $fail("The {$attribute} must match the format: {$placeholder}");
        }
    }
}
